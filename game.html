<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Donggo hate a Poop</title>
</head>

<script src="./js/phaser.min.js"></script>

<body>
  돈땃쥐미
</body>

</html>
<script type="text/javascript">
  var game = new Phaser.Game(800, 600, Phaser.CANVAS, null, { preload: preload, create: create, update: update });
  var box;
  var player;
  var keyMove;
  function preload() {
    game.load.image("box", "./images/box.png");
    game.load.image("player", "./images/character.png");

    // 게임에 필요한 데이터 로드
  }

  function create() {
    // 4,5,6번째 프레임을 0.1초 단위로 반복하는 애니메이션 생성
    /// 게임 처음 실행시 수행되는 함수
    game.physics.startSystem(Phaser.Physics.ARCADE); // 게임 속성 설정(아케이드)
    game.stage.backgroundColor = "#2F9D27";         // 게임 배경색 설청
    game.create.texture('sky', ['E'], 800, 80, 0);  // 'E' 코드색상 800x80 크기의 블럭을 'sky' 이름으로 생성
    game.add.sprite(0, 0, 'sky');                   // sky를 x좌표 0, y좌표 0 위치에 추가
    
    box = game.add.group();      // box 그룹 생성
    box.enableBody = true;       // box에 충돌속성을 설정합니다.
    for (var i = 0; i < 20; i++) {
      var rowBox = box.create(i * 40, 80, "box");
      rowBox.body.immovable = true;   // box가 움직이지 못하도록 설정합니다.
      rowBox = box.create(i * 40, 600 - 40, "box");
      rowBox.body.immovable = true;   // box가 움직이지 못하도록 설정합니다.
    }

    for (var j = 3; j < 14; j++) {
      var colBox = box.create(0, j * 40, "box");
      colBox.body.immovable = true;
      colBox = box.create(800 - 40, j * 40, "box");
      colBox.body.immovable = true;
    }

    // sky를 x좌표 0, y좌표 0 위치에 추가
    player = game.add.sprite(400, 300, "player");
    player.width = 50; //캐릭터 가로길이
    player.height = 70; //캐릭터 세로길이
    game.physics.arcade.enable(player);
    keyMove = game.input.keyboard.createCursorKeys();
  }

  function update() {
    // 프레임워크에서 주기적으로 수행하는 함수
    player.body.velocity.setTo(0, 0); // 관성을 0으로 설정
    var speed = 200;
    if (keyMove.left.isDown && keyMove.up.isDown) {
      player.body.velocity.x = -speed;
      player.body.velocity.y = -speed;

    } else if (keyMove.left.isDown && keyMove.down.isDown) {
      player.body.velocity.x = -speed;
      player.body.velocity.y = +speed;

    } else if (keyMove.right.isDown && keyMove.up.isDown) {
      player.body.velocity.x = +speed;
      player.body.velocity.y = -speed;

    } else if (keyMove.right.isDown && keyMove.down.isDown) {
      player.body.velocity.x = +speed;
      player.body.velocity.y = +speed;

    } else if (keyMove.left.isDown) {
      player.body.velocity.x = -speed;    // player x좌표 위치를 -150 속도로 이동 // player에게 'left' 애니메이션 적용

    } else if (keyMove.right.isDown) {
      player.body.velocity.x = +speed;

    } else if (keyMove.up.isDown) {
      player.body.velocity.y = -speed;

    } else if (keyMove.down.isDown) {
      player.body.velocity.y = +speed;

    } else {
      player.animations.stop();    // player에게 적용중인 애니메이션을 멈춘다. // player의 frame을 3번째 프레임으로 설정한다.
    }

    game.physics.arcade.collide(player, box); //box 와 player 충돌
  }
</script>